#!/usr/bin/env python3

###############################################################################

DEV_PATTERN = "/dev/input/event*"
IDLE_TIME = 10  # minutes
SENSOR_PIN = 11

###############################################################################

import glob
import sys
import time

from count_down import CountDown
from input_dev import InputDev
from screen import Screen
from sensor import Sensor

###############################################################################

screen = Screen(True)
clock = CountDown(IDLE_TIME*60, 1, lambda: screen.turn(False))

def activity():
    print("movement!")
    clock.reset()
    screen.turn(True)

procs = [InputDev(x, activity) for x in glob.glob(DEV_PATTERN)]
sensor = Sensor(SENSOR_PIN, activity)
procs.append(sensor)
procs.append(clock)

###############################################################################

def main ():
    for p in procs:
        p.start()

    while True:
        try:
            time.sleep(1)
        except KeyboardInterrupt:
            for p in procs:
                p.stop()
            return 0

if __name__ == "__main__":
    sys.exit(main())

##############################################################################
